<!DOCTYPE html>
<html>

<head>
    <title>Web UI</title>
    <link rel="stylesheet" href="./bulma.min.css">
    <link rel="stylesheet" href="./index.css">
    <script src="./eventemitter2.min.js"></script>
    <script src="./roslib.min.js"></script>
    <script src="./three.min.js"></script>
    <script src="./ros3d.min.js"></script>
    <script src="./anime.min.js"></script>
    <script src="./konva.min.js"></script>

    <style>
        .hidden {
            display: none;
        }

        .gyro-circle0 {
            fill: none;
            stroke-width: 10;
            transform-origin: center;
            transform: rotate(135deg);
            /* Rotate to start at top left */
        }

        .gyro-circle1 {
            fill: none;
            stroke-width: 10;
            transform-origin: center;
            transform: rotate(135deg);
            /* Rotate to start at top left */
        }
    </style>
</head>

<body>
    <nav class="navbar" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="https://bulma.io">
                <svg width="640" height="160" viewBox="0 0 640 160" fill="none" xmlns="http://www.w3.org/2000/svg"
                    class="navbar-svgs">
                    <path stroke="#3498db" stroke-width="10" fill="none"
                        d="M10,150 L100,150 L120,40 L140,150 L130,95 L110,95 L109,100 L135,100" fill="red"
                        class="bd-svg-black" />
                    <!-- A -->
                    <path stroke="#3498db" stroke-width="10" fill="none" d="M140,150 L160,40 L180,150 L200,40 L400,40"
                        fill="red" class="bd-svg-black" /> <!-- W -->
                </svg>
            </a>

            <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false"
                data-target="navbarBasicExample">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>

        <div id="navbarBasicExample" class="navbar-menu">
            <div class="navbar-start">
                <a class="navbar-item" href="./index.html">
                    Home
                </a>
                <a class="navbar-item" href="./maintenance.html">
                    Maintenance
                </a>
                <a class="navbar-item" href="./ROS_if.html">
                    ROS Interface
                </a>
                <a class="navbar-item" href="./ROS_if_imv.html">
                    ROS Image Viewer
                </a>
                <a class="navbar-item" href="./slam.html">
                    SLAM
                </a>
                <a class="navbar-item" href="./upload.html">
                    Konfigurasi
                </a>
            </div>
        </div>
    </nav>
    <br>

    <!-- Lidar bawah, ditata obstacle didepannya ada atau tidak
    Kamera, buat gambar kotak per 1 meter kayak di mobil
    Lidar kiri, ditutupin nanti masuk apa enggak
    Lidar kanan, ditutupin nanti masuk apa enggak
    Gyro, towing diputar hadap kiri dan kanan sampai target derajat

    Transmisi dirubah F-N-R
    Steer diputer ke kiri dan ke kanan sampek target derajat
    Throttle gas di injak sampai target kecepatan
    Brake di injak sampai nyentuh 2 LS -->



    <div class="container is-fluid">
        <div id="maintenance">
            <div class="box maintenance-step" data-step="1"
                style="max-width: 600px; margin: 0 auto; position: relative; text-align: center;">
                <h2 class="subtitle">LIDAR Bawah</h2>
                <!-- Viewer area -->
                <div class="has-text-centered">
                    <div id="lidarView"
                        style="display:inline-block; width:560px; height:320px; border:1px solid #eee; border-radius:8px;">
                    </div>
                </div>

                <!-- Connection status -->
                <p id="lidar-status" class="has-text-grey is-size-7">Connecting to LIDAR...</p>

                <div class="comment-box">
                    <p>‚úÖ Pastikan titik LIDAR mengenai balok pada zona <span class="green">hijau</span></p>
                    <p>‚ùå Pastikan titik LIDAR tidak mengenai balok pada zona <span class="red">merah</span></p>
                    <p>üëâ Kalibrasi dapat dilakukan dengan menyesuaikan <b>ketinggian</b> LIDAR atau <b>pitch</b> LIDAR.
                    </p>

                    <br>

                    <div class="result-choice">
                        <label>
                            <input type="radio" name="hasil1" value="pass"> Berhasil
                        </label>
                        <label>
                            <input type="radio" name="hasil1" value="fail"> Gagal
                        </label>
                    </div>
                </div>


                <div class="comment-form" style="display: none;">
                    <form>
                        <label for="komentar">Komentar</label>
                        <textarea class="komentar" name="komentar1" rows="4"
                            placeholder="Tuliskan komentar..."></textarea>
                    </form>
                </div>

                <div style="display: flex; justify-content: flex-end; margin-top: 1rem;">
                    <button id="btn-next" class="btn-next" disabled>Lanjut</button>
                </div>
            </div>

            <div class="box maintenance-step hidden" data-step="2"
                style="max-width: 600px; margin: 0 auto; position: relative; text-align: center;">
                <h2 class="subtitle">Kamera</h2>

                <div style="position:relative; display:inline-block;">
                    <!-- web_video_server stream -->
                    <img id="cam" src="" alt="camera view" style="display:block; width:640px; height:360px;">
                    <!-- overlay canvas (same size as displayed image) -->
                    <canvas id="overlay" width="640" height="360" style="position:absolute; left:0; top:0;"></canvas>
                </div>

                <div class="comment-box">
                    <p>‚úÖ Pastikan box overlay pada frame kamera <b>tepat menutupi kalibrator</b>.</p>
                    <p>‚ùå Jika tidak maka posisi kamera <b>salah</b>.</p>
                    <p>üëâ Kalibrasi dapat dilakukan dengan menyesuaikan <b>ketinggian, pitch, atau yaw</b> kamera.</p>
                    </p>

                    <br>

                    <div class="result-choice">
                        <label>
                            <input type="radio" name="hasil2" value="pass"> Berhasil
                        </label>
                        <label>
                            <input type="radio" name="hasil2" value="fail"> Gagal
                        </label>
                    </div>
                </div>

                <div class="comment-form" style="display: none;">
                    <form>
                        <label for="komentar">Komentar</label>
                        <textarea class="komentar" name="komentar2" rows="4"
                            placeholder="Tuliskan komentar..."></textarea>
                    </form>
                </div>

                <div style="display: flex; justify-content: flex-end; margin-top: 1rem;">
                    <button id="btn-next" class="btn-next" disabled>Lanjut</button>
                </div>
            </div>

            <div class="box maintenance-step hidden" data-step="3"
                style="max-width: 600px; margin: 0 auto; position: relative; text-align: center;">
                <h2 class="subtitle">Lidar Samping</h2>

                <div class="comment-box">
                    <p>‚úÖ Pastikan alarm <b>berbunyi</b> ketika terhalang object.</p>
                    <p>‚ùå Jika tidak maka ada masalah pada sistem.</p>
                    <p>üëâ Periksa koneksi dan restart towing</p>

                    <br>

                    <div class="result-choice">
                        <label>
                            <input type="radio" name="hasil3" value="pass"> Berhasil
                        </label>
                        <label>
                            <input type="radio" name="hasil3" value="fail"> Gagal
                        </label>
                    </div>
                </div>

                <div class="comment-form" style="display: none;">
                    <form>
                        <label for="komentar">Komentar</label>
                        <textarea class="komentar" name="komentar3" rows="4"
                            placeholder="Tuliskan komentar..."></textarea>
                    </form>
                </div>

                <div style="display: flex; justify-content: flex-end; margin-top: 1rem;">
                    <button id="btn-next" class="btn-next" disabled>Lanjut</button>
                </div>
            </div>


            <div class="box maintenance-step hidden" data-step="4"
                style="max-width: 600px; margin: 0 auto; position: relative; text-align: center;">
                <h2 class="subtitle">Steering</h2>

                <svg>
                    <circle class="steering-circle0" cx="50" cy="50" r="40" stroke="#e0e0e0"></circle>
                    <circle class="steering-circle1" cx="50" cy="50" r="40" stroke="#4caf50"></circle>
                    <text x="52" y="52" id="steering-text">0 deg</text>
                </svg>

                <div class="comment-box">
                    <p>‚úÖ Pastikan data kemudi <b>berubah</b> jika kemudi diputar ke kiri atau ke kanan.</p>
                    <p>‚ùå Jika tidak maka ada masalah pada sistem.</p>
                    <p>üëâ Periksa koneksi dan restart towing</p>

                    <br>

                    <div class="result-choice">
                        <label>
                            <input type="radio" name="hasil4" value="pass"> Berhasil
                        </label>
                        <label>
                            <input type="radio" name="hasil4" value="fail"> Gagal
                        </label>
                    </div>
                </div>

                <div class="comment-form" style="display: none;">
                    <form>
                        <label for="komentar">Komentar</label>
                        <textarea class="komentar" name="komentar4" rows="4"
                            placeholder="Tuliskan komentar..."></textarea>
                    </form>
                </div>

                <div style="display: flex; justify-content: flex-end; margin-top: 1rem;">
                    <button id="btn-next" class="btn-next" disabled>Lanjut</button>
                </div>
            </div>

            <div class="box maintenance-step hidden" data-step="5"
                style="max-width: 600px; margin: 0 auto; position: relative; text-align: center;">
                <h2 class="subtitle">Gas</h2>

                <svg>
                    <circle class="velocity-circle0" cx="50" cy="50" r="40" stroke="#e0e0e0"></circle>
                    <circle class="velocity-circle1" cx="50" cy="50" r="40" stroke="#4caf50"></circle>
                    <circle class="velocity-circle2" cx="50" cy="50" r="30" stroke="#cf1f10"></circle>
                    <text x="52" y="52" id="velocity-text">0%</text>
                </svg>
                <p id="velocity-kmph" class="has-text-centered" style="padding-top: 10px;">0 km/h</p>

                <div class="comment-box">
                    <p>‚úÖ Pastikan target kecepatan <b>berubah</b> ketika pedal gas diinjak.</p>
                    <p>‚ùå Jika tidak maka ada masalah pada sistem.</p>
                    <p>üëâ Periksa koneksi dan restart towing</p>

                    <br>

                    <div class="result-choice">
                        <label>
                            <input type="radio" name="hasil5" value="pass"> Berhasil
                        </label>
                        <label>
                            <input type="radio" name="hasil5" value="fail"> Gagal
                        </label>
                    </div>
                </div>

                <div class="comment-form" style="display: none;">
                    <form>
                        <label for="komentar">Komentar</label>
                        <textarea class="komentar" name="komentar5" rows="4"
                            placeholder="Tuliskan komentar..."></textarea>
                    </form>
                </div>

                <div style="display: flex; justify-content: flex-end; margin-top: 1rem;">
                    <button id="btn-next" class="btn-next" disabled>Lanjut</button>
                </div>
            </div>

            <!-- <div class="box maintenance-step hidden" data-step="6"
                style="max-width: 600px; margin: 0 auto; position: relative; text-align: center;">
                <h2 class="subtitle">Rem</h2>

                <p>
                    Pastikan Rem aktif dengan klik tombol
                </p>

                <div style="display: flex; justify-content: flex-end; margin-top: 1rem;">
                    <button class="button is-primary next-btn">Next</button>
                </div>
            </div> -->

            <div class="box maintenance-step hidden" data-step="6"
                style="max-width: 600px; margin: 0 auto; position: relative; text-align: center;">
                <h2 class="subtitle">Gyroscope</h2>

                <svg>
                    <circle class="gyro-circle0" cx="50" cy="50" r="40" stroke="#e0e0e0"></circle>
                    <circle class="gyro-circle1" cx="50" cy="50" r="40" stroke="#4caf50"></circle>
                    <text x="52" y="52" id="gyro-text">0 deg</text>
                </svg>

                <div class="comment-box">
                    <p>‚úÖ Putar towing ke kiri 30 derajat, lalu ke kanan 30 derajat.</p>
                    <p>‚ùå Jika tidak maka ada masalah pada sistem.</p>
                    <p>üëâ Periksa koneksi dan restart towing</p>

                    <br>

                    <div class="result-choice">
                        <label>
                            <input type="radio" name="hasil6" value="pass"> Berhasil
                        </label>
                        <label>
                            <input type="radio" name="hasil6" value="fail"> Gagal
                        </label>
                    </div>
                </div>

                <div class="comment-form" style="display: none;">
                    <form>
                        <label for="komentar">Komentar</label>
                        <textarea class="komentar" name="komentar6" rows="4"
                            placeholder="Tuliskan komentar..."></textarea>
                    </form>
                </div>

                <div style="display: flex; justify-content: flex-end; margin-top: 1rem;">
                    <button id="btn-next" class="btn-next" disabled>Lanjut</button>
                </div>
            </div>

            <div class="box maintenance-step hidden" id="ringkasan-box"
                style="max-width: 600px; margin: 0 auto; position: relative; text-align: center;">
                <h2 class="subtitle">Hasil Kalibrasi</h2>
                <div id="ringkasan" style="text-align: left; max-height: 400px; overflow-y: auto;"></div>
            </div>

        </div>
    </div>

    <script>
        document.querySelectorAll(".maintenance-step").forEach((form, index) => {
            const radioButtons = form.querySelectorAll('input[type="radio"]');
            const commentForm = form.querySelector('.comment-form');
            const nextButton = form.querySelector('.btn-next');

            radioButtons.forEach(radio => {
                radio.addEventListener('change', function () {
                    if (this.value === 'pass') {
                        commentForm.style.display = 'none';
                        nextButton.disabled = false;
                        nextButton.classList.add("active");
                        localStorage.setItem(`hasil_${index}`, "‚úÖ Berhasil");
                        localStorage.setItem(`komentar_${index}`, "");
                        // console.log(localStorage.getItem(`hasil_${index}`));
                        // console.log(localStorage.getItem(`komentar_${index}`));
                    } else {
                        commentForm.style.display = 'block';
                        nextButton.disabled = true;
                        nextButton.classList.remove("active");
                        localStorage.setItem(`hasil_${index}`, "‚ùå Gagal");
                        // console.log(localStorage.getItem(`hasil_${index}`));
                    }
                });
            });

            commentForm.addEventListener('input', function () {
                const commentText = this.querySelector('.komentar').value.trim();
                if (commentText.length > 0) {
                    nextButton.disabled = false;
                    nextButton.classList.add("active");
                    localStorage.setItem(`komentar_${index}`, commentText);
                    // console.log(localStorage.getItem(`komentar_${index}`));
                } else {
                    nextButton.disabled = true;
                    nextButton.classList.remove("active");
                }
            });

            nextButton.addEventListener('click', function () {
                let currentBox = this.closest(".maintenance-step");
                let currentStep = parseInt(currentBox.dataset.step);
                let nextBox = document.querySelector(`.maintenance-step[data-step="${currentStep + 1}"]`);

                currentBox.classList.add("hidden");

                if (nextBox) {
                    nextBox.classList.remove("hidden");
                    nextBox.scrollIntoView({ behavior: "smooth" });
                } else {
                    console.log("Selesai semua langkah.");
                    tampilkanRingkasan();
                    document.getElementById("ringkasan-box").classList.remove("hidden");
                    document.getElementById("ringkasan-box").scrollIntoView({ behavior: "smooth" });
                }

                this.disabled = true;
            });
        });

        function tampilkanRingkasan() {
            let hasilHTML = "<ul>";
            for (let i = 0; i < 6; i++) { // max 6 step
                const hasil = localStorage.getItem(`hasil_${i}`);
                // console.log(hasil);
                if (!hasil) continue;
                const komentar = localStorage.getItem(`komentar_${i}`);
                hasilHTML += `<li>
            <strong>Step ${i + 1}:</strong> ${hasil}
            ${komentar ? `<br>üí¨ Komentar: ${komentar}` : ""}
        </li>`;
            }
            hasilHTML += "</ul>";
            document.getElementById("ringkasan").innerHTML = hasilHTML;
        }
    </script>

    <script type="text/javascript" src="maintenance.js">
    </script>
</body>

</html>